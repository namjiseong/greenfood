<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Greenfood</title>
	<link rel="stylesheet" href="./static/css/common.css">

	
	<script>
		
		var kal_list = {{ kal_list|tojson }};
		var tan_list = {{ tan_list|tojson }};
		var dan_list = {{ dan_list|tojson }};
		var ji_list = {{ ji_list|tojson }};
	</script>
</head>

<body>
	
	<div class="container">
		<header class="header">
			<div class="w_inner">
				<!-- 로고 -->
				<h1 class="logo_img">
					<a href="index.html" class="link_home">
						<img src="./static/images/img_logo.jpg" alt="그린푸드" class="img_g">
					</a>
				</h1>

				<nav class="wrap_gnb">
					<ul class="list_gnb">
						<li><a href="#none">로그인</a></li>
						<li><a href="#none">로그아웃</a></li>
						<li><a href="#none">마이페이지</a></li>
						<li><a href="#none">운동추천</a></li>
					</ul>
				</nav>

			</div>
		</header>
		<main class="contents">
			<div class="w_inner">
				<h2 class="blind">검색 결과 상세</h2>
				<div class="wrap_result">
					<div class="result_img">
						<div class="txt_img">검색 이미지</div>
						<div class="thumb_area">
							
							{% if True %}
							<img src="{{ url_for('static', filename=Img)}}" alt="음식" class="img_g" width="600">
							{% endif %}
						</div>
					</div>

					<div class="search_detail">
						<form action="/add" method="POST">
							<fieldset>
								<legend class="blind">음식 검색하기</legend>
								<div class="wrap_row">
									<input type="text" class="inp_search" name = 'food_name' placeholder="검색해서 직접 추가">
									<input type="hidden" id="f_list" name="food_list" value="">
									<input type="hidden" name="image" value="{{Img}}">
									<button type="submit" class="btn_search">검색</button>
								</div>
							</fieldset>
						</form>
					</div>
					<div class="result_detail">
						<div class="area_detail">
							<h3 class="tit_detail"><span>검출된 음식 목록</span></h3>
							<ul class="list_food" id="abc">

							</ul>
						</div>
						<div class="area_detail">
							<h3 class="tit_detail"><span>1일 기준 영양성분</span></h3>
							<div class="wrap_progress">
								<dl>
									<div class="group_progress type3">
										<dt>총 칼로리</dt>
										<dd>
											<span class="area_progress">
												<!-- width값으로 그래프 조절합니다. style="width:{{kal}}%"-->
												
												<span class="bar_progress" style="width:50%" id="kal"></span> 
												
											</span>
											<span class="num_percent" id="kal_p">%</span>
										</dd>
									</div>
									<div class="group_progress type1">
										<dt>탄수화물</dt>
										<dd>
											<span class="area_progress">
												<span class="bar_progress" style="width:60%" id='tan'></span>
											</span>
											<span class="num_percent" id="tan_p">%</span>
										</dd>
									</div>
									<div class="group_progress type2">
										<dt>단백질</dt>
										<dd>
											<span class="area_progress">
												<span class="bar_progress" style="width:30%" id="dan"></span>
											</span>
											<span class="num_percent" id="dan_p">%</span>
										</dd>
									</div>
									<div class="group_progress type4">
										<dt>지방</dt>
										<dd>
											<span class="area_progress">
												<span class="bar_progress" style="width:70%" id="ji"></span>
											</span>
											<span class="num_percent" id="ji_p">%</span>
										</dd>
									</div>
								</dl>
							</div>
						</div>
					</div>
				</div>
			</div>
		</main>
		<footer class="footer">
			<div class="w_inner">
				<dl class="list_desc">
					<div class="area_desc">
						<dt>주의사항:</dt>
						<dd>내용 입력</dd>
					</div>
					<div class="area_desc">
						<dt>DB 출처:</dt>
						<dd>내용 입력</dd>
					</div>
					<div class="area_desc">
						<dt>정보 관리 정책:</dt>
						<dd>내용 입력</dd>
					</div>
				</dl>
			</div>
		</footer>
	</div>
	<script>
		//퍼센트 입력
		view_p()


		//리스트->하나씩 함수 실행
		var list_f = {{ food_list|tojson }};
		console.log(list_f)
		for (let i = 0; i < list_f.length; i++) {
			ad_food(list_f[i])
			console.log(list_f[i]);
		}
		
		//음식리스트 전송함수
		function totext(){
			var inputt = document.getElementById('f_list');
			var f_list = "";
			for (let i = 0; i < list_f.length; i++) {
				f_list = f_list +" "+ list_f[i]
			}
			inputt.setAttribute('value', f_list);
			
		}


		//음식목록 추가 함수
		function ad_food(food_name){
			var li = document.createElement("li");
			li.setAttribute('id', food_name);

			var span = document.createElement('span');
			span.setAttribute('class', 'name_food');
			span.innerHTML= food_name;
			var span2 = document.createElement('span');
			var span3 = document.createElement('span');
			span3.innerHTML= "  ";
			span.appendChild(span3);
			span2.setAttribute('id', food_name +'count');
			span2.innerHTML= 1;
			span.appendChild(span2);
			
			var bu1 = document.createElement('button');
			bu1.setAttribute('class', "btn_add");
			bu1.innerHTML='&#43;';
			bu1.setAttribute('onclick', 'another_add_food("'+food_name+'")');
			
			span_mini = document.createElement('span');
			span_mini.setAttribute('class', 'blind');
			span_mini.innerHTML = "추가";

			var bu2 = document.createElement('button');
			bu2.setAttribute('class', "btn_remove");
			bu2.innerHTML ='&#215;';
			bu2.setAttribute('onclick', 'de_food("'+food_name+'")');

			span_mini2 = document.createElement('span');
			span_mini2.setAttribute('class', "blind");
			span_mini2.innerHTML = "삭제";
			bu2.appendChild(span_mini2);
			span.appendChild(bu2);


			bu1.appendChild(span_mini);
			span.appendChild(bu1);
			li.appendChild(span);
			document.getElementById("abc").appendChild(li);
			totext()
		}
		//제거함수
		function de_food(food_name){
			//제거
			var target = document.getElementById(food_name);
			var parent = target.parentElement; 
			parent.removeChild(target);
			// 타겟 인덱스 반환
			var index = list_f.indexOf(food_name);
			// 타겟 제외한 리스트 반환
			list_f = list_f.filter((element) => element !== food_name);
			//리스트에서 제거
			kal_list.splice(index, 1);
			dan_list.splice(index, 1);
			tan_list.splice(index, 1);
			ji_list.splice(index, 1);
			//제거된 리스트 기반으로 퍼센트 표시
			var kal = 0;
			for (let i = 0; i < kal_list.length; i++) {
				kal += kal_list[i];
			}
			kal = Math.round(kal/2300 * 100) ;
			document.getElementById( 'kal' ).style.width = kal+'%';
			var tan = 0;
			for (let i = 0; i < tan_list.length; i++) {
				tan += tan_list[i];
			}
			tan = Math.round(tan/324 *100);
			document.getElementById( 'tan' ).style.width = tan +'%';
			var dan = 0;
			for (let i = 0; i < dan_list.length; i++) {
				dan += dan_list[i];
			}
			dan = Math.round(dan/55 * 100);
			document.getElementById( 'dan' ).style.width = dan +'%';
			var ji = 0;
			for (let i = 0; i < ji_list.length; i++) {
				ji += ji_list[i];
			}
			ji = Math.round(ji/54 * 100);
			document.getElementById( 'ji' ).style.width = ji +'%';

			

			document.getElementById('kal_p').innerHTML=kal + '%';
			document.getElementById('tan_p').innerHTML=tan+'%';
			document.getElementById('dan_p').innerHTML=dan+'%';
			document.getElementById('ji_p').innerHTML=ji+'%';

			totext()
		}
		// 추가 함수
		function another_add_food(food_name){
			// 타겟 인덱스 반환
			var index = list_f.indexOf(food_name);
			//2배로 증가
			kal_list[index] = kal_list[index] * 2;
			dan_list[index] = dan_list[index] * 2;
			tan_list[index] = tan_list[index] * 2;
			ji_list[index] = ji_list[index] * 2;
			//수정된 리스트 기반으로 퍼센트 표시
			var kal = 0;
			for (let i = 0; i < kal_list.length; i++) {
				kal += kal_list[i];
			}
			kal = Math.round(kal/2300 * 100) ;
			document.getElementById( 'kal' ).style.width = kal+'%';
			var tan = 0;
			for (let i = 0; i < tan_list.length; i++) {
				tan += tan_list[i];
			}
			tan = Math.round(tan/324 *100);
			document.getElementById( 'tan' ).style.width = tan +'%';
			var dan = 0;
			for (let i = 0; i < dan_list.length; i++) {
				dan += dan_list[i];
			}
			dan = Math.round(dan/55 * 100);
			document.getElementById( 'dan' ).style.width = dan +'%';
			var ji = 0;
			for (let i = 0; i < ji_list.length; i++) {
				ji += ji_list[i];
			}
			ji = Math.round(ji/54 * 100);
			document.getElementById( 'ji' ).style.width = ji +'%';

			

			document.getElementById('kal_p').innerHTML=kal + '%';
			document.getElementById('tan_p').innerHTML=tan+'%';
			document.getElementById('dan_p').innerHTML=dan+'%';
			document.getElementById('ji_p').innerHTML=ji+'%';

			var count = document.getElementById(food_name + 'count');
			count.innerHTML = (parseInt(count.innerHTML) + 1);
			
			totext()
		}

		function view_p(){
			var kal = 0;
			for (let i = 0; i < kal_list.length; i++) {
				kal += kal_list[i];
			}
			kal = Math.round(kal/2300 * 100) ;
			document.getElementById( 'kal' ).style.width = kal+'%';
			var tan = 0;
			for (let i = 0; i < tan_list.length; i++) {
				tan += tan_list[i];
			}
			tan = Math.round(tan/324 *100);
			document.getElementById( 'tan' ).style.width = tan +'%';
			var dan = 0;
			for (let i = 0; i < dan_list.length; i++) {
				dan += dan_list[i];
			}
			dan = Math.round(dan/55 * 100);
			document.getElementById( 'dan' ).style.width = dan +'%';
			var ji = 0;
			for (let i = 0; i < ji_list.length; i++) {
				ji += ji_list[i];
			}
			ji = Math.round(ji/54 * 100);
			document.getElementById( 'ji' ).style.width = ji +'%';

			

			document.getElementById('kal_p').innerHTML=kal + '%';
			document.getElementById('tan_p').innerHTML=tan+'%';
			document.getElementById('dan_p').innerHTML=dan+'%';
			document.getElementById('ji_p').innerHTML=ji+'%';
		}



	</script>
	
</body>

</html>