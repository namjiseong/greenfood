<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
	<!-- <meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
	<title>Greenfood</title>
	<link rel="stylesheet" href="./static/css/common.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
	<script src="./static/js/common.ui.js" > </script>
	<script>
		var kal_list = []
		var tan_list = []
		var dan_list = []
		var ji_list = []
		
	</script>
	<style>
		.area_detail{
			width : 100px;
			padding : 30px;
		}
		
        #id{
            text-align: center;
            display: block;
            padding: 20px;
        }
    
	</style>
</head>

<body>
	<div class="container">
		<header class="header">
			<div class="w_inner">
				<!-- 로고 -->
				<h1 class="logo_img">
					<a href="/" class="link_home">
						<img src="./static/images/img_logo.jpg" alt="그린푸드" class="img_g">
					</a>
				</h1>

				<nav class="wrap_gnb">
					<ul class="list_gnb">
						<span id="id">{{id}}</span>
						<li><a href="login" id="login">로그인</a></li>
						<!-- <li><a href="#none">로그아웃</a></li> -->
						<li><a href="#none">마이페이지</a></li>
						<li><a href="statistic">통계</a></li>
					</ul>
				</nav>

			</div>
		</header>
		<main class="contents">
			<div class="w_inner">
				<h2 class="tit_page"><span>통계</span></h2>
				<div class="wrap_statistic">
					<div class="area_statistic">
						<div class="field_row">
							<span class="tit_inp">날짜 선택 : </span>
							<input type="date" name="" id="date" class="inp_date" onchange="view_date()">
						</div>

						

						<strong class="tit_progress">일일 섭취 영양 성분</strong>
						<div class="wrap_progress">
							<dl>
								<div class="group_progress type3">
									<dt>총 칼로리</dt>
									<dd>
										<span class="area_progress">
											<!-- width값으로 그래프 조절합니다. -->
											<span class="bar_progress" style="width:50%" id="kal"></span>
										</span>
										<span class="num_percent" id="kal_p">50%</span>
									</dd>
								</div>
								<div class="group_progress type1">
									<dt>탄수화물</dt>
									<dd>
										<span class="area_progress">
											<span class="bar_progress" style="width:60%" id="tan"></span>
										</span>
										<span class="num_percent" id="tan_p">60%</span>
									</dd>
								</div>
								<div class="group_progress type2">
									<dt>지방</dt>
									<dd>
										<span class="area_progress">
											<span class="bar_progress" style="width:30%" id="ji"></span>
										</span>
										<span class="num_percent" id="ji_p">30%</span>
									</dd>
								</div>
								<div class="group_progress type4">
									<dt>단백질</dt>
									<dd>
										<span class="area_progress">
											<span class="bar_progress" style="width:70%" id="dan"></span>
										</span>
										<span class="num_percent" id="dan_p">70%</span>
									</dd>
								</div>
							</dl>
						</div>
					</div>

					<div class="area_detail">
						<h2 class="tit_detail"><span>음식 목록</span></h2>
						<br>
						<ul class="list_food" id="abc">

						</ul>
					</div>

					<div class="area_statistic">
						<strong class="tit_progress">평균 섭취 영양 성분</strong>
						<div class="wrap_progress">
							<!-- <dl>
								<div class="group_progress type5">
									<dt>고혈압 위험도: </dt>
									<dd>
										<span class="area_progress">
											<!-- width값으로 그래프 조절합니다. -->
											<!-- <span class="bar_progress" style="width:50%"></span>
										</span>
										<span class="num_percent">50%</span>
									</dd>
								</div>
								<div class="group_progress type6">
									<dt>당뇨병 위험도:</dt>
									<dd>
										<span class="area_progress">
											<span class="bar_progress" style="width:60%"></span>
										</span>
										<span class="num_percent">60%</span>
									</dd>
								</div>
							</dl> -->
							<dl>
								<div class="group_progress type3">
									<dt>총 칼로리</dt>
									<dd>
										<span class="area_progress">
											<!-- width값으로 그래프 조절합니다. -->
											<span class="bar_progress" id="avg_kal"style="width:50%"></span>
										</span>
										<span class="num_percent" id="avg_kal_p">50%</span>
									</dd>
								</div>
								<div class="group_progress type1">
									<dt>탄수화물</dt>
									<dd>
										<span class="area_progress">
											<span class="bar_progress" id="avg_tan" style="width:60%"></span>
										</span>
										<span class="num_percent" id="avg_tan_p">60%</span>
									</dd>
								</div>
								<div class="group_progress type2">
									<dt>지방</dt>
									<dd>
										<span class="area_progress">
											<span class="bar_progress" id="avg_ji" style="width:30%"></span>
										</span>
										<span class="num_percent" id="avg_ji_p">30%</span>
									</dd>
								</div>
								<div class="group_progress type4">
									<dt>단백질</dt>
									<dd>
										<span class="area_progress">
											<span class="bar_progress" id="avg_dan" style="width:70%"></span>
										</span>
										<span class="num_percent" id="avg_dan_p">70%</span>
									</dd>
								</div>
							</dl>
						</div>
					</div>
					<form action="/test" method="POST" style="margin-top:150px;margin-left:15px">
						<input type="hidden" name="per_list" id="per" value="">
						<input type="hidden" name="avg_list" id="avg_list" value="">
						<button type="submit" class=" btn_search" style="width:150px"onclick=inputenergy()>성인병 위험도 진단</button>
						
					</form>
					

				</div>
			</div>
		</main>
		<footer class="footer">
			<div class="w_inner">
				<dl class="list_desc">
					<div class="area_desc">
						<dt>주의사항:</dt>
						<dd>내용 입력</dd>
					</div>
					<div class="area_desc">
						<dt>DB 출처:</dt>
						<dd>내용 입력</dd>
					</div>
					<div class="area_desc">
						<dt>정보 관리 정책:</dt>
						<dd>내용 입력</dd>
					</div>
				</dl>
			</div>
		</footer>
	</div>
	<script>
		

		function view_date(){
			a = document.getElementById('abc');
			while (a.hasChildNodes()) {
				a.removeChild(a.firstChild);
			}

			var date = document.getElementById('date');
			
			console.log(date.value);
			// 해당 날짜 DB에서 검색해서 퍼센트 띄우기
			$.ajax({
				type : 'POST',                                  
				url : 'https://00f3-49-175-24-22.jp.ngrok.io/statistic',
				data : {
						date:date.value + ' 00:00:00'                     
				},
				dataType : 'JSON',
				contentType: 'application/x-www-form-urlencoded; charset=euc-kr',
				success : function(result){


						var food_names = []
						var count = []
						kal_list = []
						tan_list = []
						dan_list = []
						ji_list = []

						for (var i=0; i < result.length;i++){
							food_names.push(result[i][0]);
							count.push(result[i][1]);
							for (var j =0;j < result[i][1];j++){
								kal_list.push(result[i][2]);
								tan_list.push(result[i][3]);
								dan_list.push(result[i][4]);
								ji_list.push(result[i][5]);
							}
							
						}
						console.log(food_names)
						console.log(count)
						// 음식 목록 표시
						for (var i=0; i < food_names.length;i++){
							var li = document.createElement("li");
							li.innerHTML = food_names[i] + "  " + count[i];
							document.getElementById("abc").appendChild(li);
						}
						// 퍼센트 변경
						view_p()

				},
				error : function(xtr,status,error){
						alert(xtr +":"+status+":"+error);
				}
			});
		}
		

		function avg_view(kal, tan, dan, ji){
			kal = Math.round(kal/2300 * 100) ;
			document.getElementById( 'avg_kal' ).style.width = 0+'%';
			tag(kal, 'avg_kal')
			tan = Math.round(tan/324 *100);
			document.getElementById( 'avg_tan' ).style.width = 0 +'%';
			tag(tan, 'avg_tan')
			dan = Math.round(dan/55 * 100);
			document.getElementById( 'avg_dan' ).style.width = 0 +'%';
			tag(dan, 'avg_dan')
			ji = Math.round(ji/54 * 100);
			document.getElementById( 'avg_ji' ).style.width = 0 +'%';
			tag(ji, 'avg_ji')

			

			document.getElementById('avg_kal_p').innerHTML=kal + '%';
			document.getElementById('avg_tan_p').innerHTML=tan+'%';
			document.getElementById('avg_dan_p').innerHTML=dan+'%';
			document.getElementById('avg_ji_p').innerHTML=ji+'%';
		}
		console.log({{avg_kal}}, {{avg_tan}}, {{avg_dan}}, {{avg_ji}})
		avg_view({{avg_kal}}, {{avg_tan}}, {{avg_dan}}, {{avg_ji}});
		

		function inputenergy(){
			//평균치 정보 기입
			document.getElementById('per').value = {{per}};
			document.getElementById('avg_list').value = [{{avg_kal}}, {{avg_tan}}, {{avg_dan}}, {{avg_ji}}];
			
		}
		logout()
	</script>
</body>

</html>